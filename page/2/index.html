<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="zjiash的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="zjiash的博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zjiash的博客">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>zjiash的博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zjiash的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/2017书单/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/2017书单/" itemprop="url">
                  2017书单
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T10:47:35+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书/" itemprop="url" rel="index">
                    <span itemprop="name">读书</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/2017书单/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/2017书单/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="人类简史"><a href="#人类简史" class="headerlink" title="人类简史"></a>人类简史</h3><ol>
<li>认知革命正是历史从生物学中脱离而独立存在的起点。</li>
<li>身为人类，我们不可能脱离想象所构建出的秩序。每一次我们以为自己打破了监狱的高墙、迈向自由的前方，其实只是到了另一间更大的监狱，把活动范围稍稍加以扩大。</li>
</ol>
<h3 id="显微镜下的大明"><a href="#显微镜下的大明" class="headerlink" title="显微镜下的大明"></a>显微镜下的大明</h3><ol>
<li>管中窥豹，折射大明政治生态，类似《明朝那些事儿》</li>
</ol>
<h3 id="草房子"><a href="#草房子" class="headerlink" title="草房子"></a>草房子</h3><ol>
<li>关于成长的故事</li>
<li>儿童形象<ul>
<li>凸鹤：意识到缺陷并面对找回尊严</li>
<li>纸月：懵懂而纯洁的感情</li>
<li>杜小康：厄运中成长成熟</li>
<li>细马：自我选择和承担责任</li>
<li>桑桑：感悟生死和人生</li>
</ul>
</li>
<li>成人形象<ul>
<li>白雀 &amp; 蒋一轮：儿童眼中的爱情</li>
<li>秦大奶奶：质朴、善良、倔强的农民形象</li>
</ul>
</li>
</ol>
<h3 id="解忧杂货点"><a href="#解忧杂货点" class="headerlink" title="解忧杂货点"></a>解忧杂货点</h3><ol>
<li>温馨的故事和精巧的结构，不过感觉有点俗套了</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/06/《深入理解Java虚拟机》之内存布局/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/06/《深入理解Java虚拟机》之内存布局/" itemprop="url">
                  《深入理解Java虚拟机》之内存布局
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-06T18:19:39+08:00">
                2017-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/06/《深入理解Java虚拟机》之内存布局/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/06/《深入理解Java虚拟机》之内存布局/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在看<a href="https://item.jd.com/11252778.html" target="_blank" rel="external">《深入理解Java虚拟机：JVM高级特性与最佳实践》</a>一书，准备做一些读书笔记总结一下，本文对Java的内存布局进行总结，后续会有更多该系列的文章。</p>
<h2 id="运行时数据区"><a href="#运行时数据区" class="headerlink" title="运行时数据区"></a>运行时数据区</h2><p>Java虚拟机在执行程序的时候，会将内存划分为若干个不同的数据区域，这些区域各有用途。</p>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/jvm/runtime_memory.png" width="500" height="500" alt="JVM运行时数据区" style="clear: both; display: block; margin:auto; "></p>
<h3 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h3><ul>
<li>线程私有</li>
<li>当前线程执行到的位置</li>
<li>如果是Java方法，则为字节码指令地址；</li>
<li>如果是Native方法，为Undefined，唯一一个JVM没有规定任何OutOfMemoryError情况的区域。</li>
<li><font color="red">问题：Native方法是如何执行的？</font>

</li>
</ul>
<h3 id="Java虚拟机栈"><a href="#Java虚拟机栈" class="headerlink" title="Java虚拟机栈"></a>Java虚拟机栈</h3><ul>
<li>线程私有</li>
<li>Java方法执行的内存模型，每个方法创建一个Stack Frame</li>
<li>存储局部变量（编译器已知）、操作数栈、动态链接、方法出口等信息</li>
<li>栈溢出：<ul>
<li>如果线程请求的栈深度大于JVM所允许的最大深度，将抛出StackOverflowError异常</li>
<li>如果JVM在拓展栈时无法申请到足够的内存空间，则抛出OutOfMemoryError异常（无法实验）</li>
</ul>
</li>
<li>栈容量可以限定，如果不能减少线程数或者更换64位虚拟机，就只能通过减少最大堆（总得栈容量剩的会多一些）和减少栈容量（每个线程的栈容量减小）来换取更多的线程</li>
</ul>
<h3 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h3><ul>
<li>和虚拟机栈作用相似，用于执行Native方法</li>
</ul>
<h3 id="Java堆"><a href="#Java堆" class="headerlink" title="Java堆"></a>Java堆</h3><ul>
<li>所有线程共享的一块内存，存放对象示例，垃圾收集器关联的主要区域</li>
<li>逻辑上连续，物理上可以不连续</li>
<li>从垃圾回收的角度，可细分为：新生代和老年代</li>
</ul>
<h3 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h3><ul>
<li>所有线程共享</li>
<li>存储已被JVM加载的类信息、常量、静态变量、即时编译器编译后的代码等数据</li>
<li>HotSpot中通过永久代来实现方法区，其他虚拟机不存在永久带，虚拟机规范并无规定实现，HotSpot也在逐步放弃永久代的方法</li>
<li>这一块的垃圾回收效果并不理想，而且条件相当苛刻</li>
<li>方法区无法满足内存分配需求时，将抛出OutOfMemoryError异常</li>
<li>进一步细分：运行时常量池、直接内存</li>
</ul>
<h2 id="HotSpot对象"><a href="#HotSpot对象" class="headerlink" title="HotSpot对象"></a>HotSpot对象</h2><h3 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h3><p>虚拟机遇到new指令时的行为？</p>
<ol>
<li>检查类名是否存在，该类是否被加载、 解析和初始化</li>
<li>分配内存（加载完成后即可确定内存大小），可以通过参数设置是否使用TLAB（本地线程分配缓冲）</li>
<li>初始化分配的内存空间（不包括对象头）为零值</li>
<li>设置对象头，例如这个对象是哪个类的实例、对应的类元数据信息、对象哈希码、对象的GC分代年龄等信息</li>
<li>构造方法</li>
</ol>
<h3 id="对象的内存布局"><a href="#对象的内存布局" class="headerlink" title="对象的内存布局"></a>对象的内存布局</h3><ul>
<li>分3块区域：对象头、实例数据、对齐填充</li>
<li>对象头：运行时数据、对象指针（并非所有虚拟机都有）</li>
<li>数组对象头还有记录数组长度的信息</li>
<li>实例数据：对象的有效信息或字段，字段存储顺序有分配策略：相同宽度的字段分配在一起，父类定义的变量出现在子类之前等</li>
<li>对齐填充：HotSpot要求对象起始地址必须是8字节的整数倍</li>
</ul>
<h3 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h3><ul>
<li>通过句柄<ul>
<li>句柄池，reference存储句柄地址，句柄中包含实例数据指针和类型数据指针</li>
<li>好处：对象被移动时修改句柄中的实例指针，reference本身不需要修改</li>
</ul>
</li>
<li>直接指针<ul>
<li>reference存储对象地址，对象将类型数据指针和实例数据存放在一起</li>
<li>好处：速度快，节省一次指针定位开销</li>
</ul>
</li>
<li>HotSpot采用直接指针的方式</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/06/关于一个赌博游戏的思考/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/06/关于一个赌博游戏的思考/" itemprop="url">
                  关于一个赌博游戏的思考
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-06T16:31:16+08:00">
                2017-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数学/" itemprop="url" rel="index">
                    <span itemprop="name">数学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/06/关于一个赌博游戏的思考/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/06/关于一个赌博游戏的思考/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>春节回家见到的一种新的赌博方式（不得不说湖北人确实喜欢赌博），规则如下: </p>
<blockquote>
<p>一副扑克牌去掉大小王剩下52张，洗好牌后每次从牌堆里面按顺序取两张，计算两张牌的点数之和（J、Q、K分布表示11、12和13），猜单双。取出的牌使用完成后，不会马上进入牌堆，最后剩下的6张牌作废（避免有人记住最后剩下的牌），重新洗牌开始进行新的一轮活动。</p>
</blockquote>
<h2 id="动手实践"><a href="#动手实践" class="headerlink" title="动手实践"></a>动手实践</h2><p>了解规则之后，我直觉出现单和双的概率是不均等的，至少在牌局的末尾，是可以根据之前出现的牌的情况制定某种策略，提高猜中概率的。粗略一想，最终结果为单的情况包括：先单后双/先双后单，为双的情况包括：两个双/两个单。如果不考虑一副牌里面单数牌比较多（多4张）的情况，似乎可以认为这个活动出现单双的概率是均等的。但是，事实是否确实如此呢？</p>
<p>回来后写了个程序来模拟这个过程，想通过统计信息来观察概率是否均等，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">public class Gambling &#123;</span><br><span class="line">    private int num;        // 数字个数，一副完整的扑克牌num=13</span><br><span class="line">    private int multiple;   // 每种数字个数，一副完整的扑克牌有4种花色</span><br><span class="line">    private int left;       // 最后的几张牌废弃掉</span><br><span class="line">    private int start;      // 统计的起始位置</span><br><span class="line">    private List&lt;Integer&gt; cards;</span><br><span class="line"></span><br><span class="line">    public Gambling(int num, int multiple, int left, int start) &#123;</span><br><span class="line">        this.num = num;</span><br><span class="line">        this.multiple = multiple;</span><br><span class="line">        this.left = left;</span><br><span class="line">        this.start = start;</span><br><span class="line"></span><br><span class="line">        cards = new ArrayList&lt;Integer&gt;(num * multiple);</span><br><span class="line">        for (int i = 0; i &lt; num * multiple; i++) &#123;</span><br><span class="line">            cards.add(i / multiple + 1);</span><br><span class="line">        &#125;</span><br><span class="line">        // System.out.println(&quot;arrays: &quot; + cards);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sample(int times) &#123;</span><br><span class="line">        int totalOddNum = 0, totalEvenNum = 0;</span><br><span class="line">        for (int i = 0; i &lt; times; i++) &#123;</span><br><span class="line">            Random rnd = new Random(System.currentTimeMillis());</span><br><span class="line">            Collections.shuffle(cards, rnd);</span><br><span class="line"></span><br><span class="line">            int oddNum = 0, evenNum = 0;</span><br><span class="line">            for (int j = start; j &lt; (num * multiple - left) / 2; j++) &#123;</span><br><span class="line">                int value = cards.get(j * 2) + cards.get(j * 2 + 1);</span><br><span class="line">                if (value % 2 == 0) &#123;</span><br><span class="line">                    evenNum++;</span><br><span class="line">                    totalEvenNum++;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    oddNum++;</span><br><span class="line">                    totalOddNum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            int total = oddNum + evenNum;</span><br><span class="line">            if (i &lt; 5) &#123;</span><br><span class="line">                System.out.println(String.format(&quot;#%d: oddRate = %.3f, evenRate = %.3f&quot;,</span><br><span class="line">                        i, oddNum * 1.0 / total, evenNum * 1.0 / total));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        int totalNum = totalOddNum + totalEvenNum;</span><br><span class="line">        System.out.println(String.format(&quot;total(%d): totalOddRate = %.5f, totalEvenRate = %.5f&quot;,</span><br><span class="line">                totalNum, totalOddNum * 1.0 / totalNum, totalEvenNum * 1.0 / totalNum));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Gambling gambling = new Gambling(13, 4, 6, 0);</span><br><span class="line">        gambling.sample(1000000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行多次的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">total(23000000): totalOddRate = 0.50739, totalEvenRate = 0.49261</span><br><span class="line">total(23000000): totalOddRate = 0.50695, totalEvenRate = 0.49305</span><br><span class="line">total(23000000): totalOddRate = 0.50724, totalEvenRate = 0.49276</span><br><span class="line">total(23000000): totalOddRate = 0.50651, totalEvenRate = 0.49349</span><br><span class="line">total(23000000): totalOddRate = 0.50629, totalEvenRate = 0.49371</span><br></pre></td></tr></table></figure>
<p>从结果中可以清楚的看到，出现单的概率比出现双的概率高1.4%，结果非常稳定。这说明游戏中出现单双的概率是不均等的，看到这样的结果，我第一反应是：会不会是单数牌多4张造成的？立即将程序中的num从13改成12，再次运行发现：<font color="red">出现单的概率比出现双的概率高了约2%</font>，比之前的结果更不均衡了。</p>
<h2 id="一点想法"><a href="#一点想法" class="headerlink" title="一点想法"></a>一点想法</h2><p>为什么会出现这样的情况？我回到数学论证上来考虑一个简单的例子：简化一副扑克，考虑只有4张牌的情况，2种花色和2种数字，排列的情况如下（不考虑花色的情况）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、1、2、2</span><br><span class="line">1、2、1、2</span><br><span class="line">1、2、2、1</span><br><span class="line">2、1、1、2</span><br><span class="line">2、1、2、1</span><br><span class="line">2、2、1、1</span><br></pre></td></tr></table></figure>
<p>不考虑最后牌作废的情况，一共可以进行12次赌博活动，其中出现单的次数为8，出现双的次数为4，并不是直观上的机会均等。在这个极端的例子里面，最终结果出现双的条件相对比较苛刻，要求相邻的数字相同才行，第一个数字与第二个数字相同的概率为1/3，不同的概率为2/3，导致出现单的概率偏高。如果数字种数更多，情况应该会更好一些。通过运行下面的代码，验证了我们的想法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 1; i &lt; 7; i++) &#123;</span><br><span class="line">    Gambling gambling2 = new Gambling(i * 2, 2, 0, 0);</span><br><span class="line">    gambling2.sample(1000000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Results:</span><br><span class="line">total(2000000): totalOddRate = 0.66579, totalEvenRate = 0.33421</span><br><span class="line">total(4000000): totalOddRate = 0.55100, totalEvenRate = 0.44900</span><br><span class="line">total(6000000): totalOddRate = 0.54564, totalEvenRate = 0.45436</span><br><span class="line">total(8000000): totalOddRate = 0.53384, totalEvenRate = 0.46616</span><br><span class="line">total(10000000): totalOddRate = 0.52858, totalEvenRate = 0.47142</span><br><span class="line">total(12000000): totalOddRate = 0.51977, totalEvenRate = 0.48023</span><br></pre></td></tr></table></figure>
<p>上面的程序避免了单数牌和双数牌数目不一致的情况，更多的牌引入了更多的配对可能性，使得结果趋于均衡。如果考虑正常扑克的行为，会发现当单数牌多一种时，会导致出现双的概率增大。换句话说，13种牌单双概率的差异要比12和14种牌都要小。</p>
<p>事实上按照排列组合的分析，应该是可以得到准确的结果，一个直观的解释是：奇偶性不同的牌组合才能得到单数的结果，当单数牌比较多的时候，奇偶性不同的牌组合之后，多出的牌结果肯定是双，这一事实导致了单双概率差距缩小，使得整个游戏更为公平。对于单数牌和双数牌相同的情况，似乎也可以用上面的简化case来解释。</p>
<h2 id="赢钱策略"><a href="#赢钱策略" class="headerlink" title="赢钱策略"></a>赢钱策略</h2><p>根据上面的分析发现：出现单的概率要高，那押单是个不错的选择。如果根据一副牌已经出现的结果，来制定后面的押注策略，感觉应该还有更好的赢钱策略。这个留到回头在研究。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/15/Go语言圣经读后感/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/Go语言圣经读后感/" itemprop="url">
                  Go语言圣经读后感
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-15T12:07:48+08:00">
                2016-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/06/15/Go语言圣经读后感/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/15/Go语言圣经读后感/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近读了下<a href="http://www.gopl.io/" target="_blank" rel="external">《The Go Programming Language》</a>，网上没有找到完整的英文版，可以找到翻译的<a href="https://docs.ruanjiadeng.com/gopl-zh/index.html" target="_blank" rel="external">中文版</a>，中文版翻译得比较一般，有较多的打印和翻译错误。由于之前对Go语言有一定的了解，因此中文版看起来也没什么问题。个人觉得该书算是不错的Go语言入门书了，不管是从行文方式（用例实用且详细，同时由浅入深）还是阐述深度等方面来看，都比之前看的那本要强一些，本人从中获益良多，因此行文总结一下。</p>
<h2 id="Programming-Language"><a href="#Programming-Language" class="headerlink" title="Programming Language"></a>Programming Language</h2><h3 id="无类型常量"><a href="#无类型常量" class="headerlink" title="无类型常量"></a>无类型常量</h3><p>许多常量并没有一个明确的基础类型，编译器为这些没有明确基础类型的数字常量提供比基础类型更高精度的算术运算，你可以认为至少有256bit的运算精度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const a = 1208925819614629174706176</span><br><span class="line">fmt.Println(a / 1180591620717411303424)     // ouput 1024</span><br><span class="line">// fmt.Println(a)   // error: constant 1208925819614629174706176 overflows int</span><br><span class="line"></span><br><span class="line">var f float64 = 3 + 0i</span><br><span class="line">fmt.Println(f)  // output 3</span><br></pre></td></tr></table></figure>
<p>只有常量可以是无类型的。当一个无类型的常量被赋值给一个变量的时候，无类型的常量将会被隐式转换为对应的类型，如果转换合法的话。</p>
<h3 id="包的初始化"><a href="#包的初始化" class="headerlink" title="包的初始化"></a>包的初始化</h3><ol>
<li>包的初始化首先是解决包级变量的依赖顺序，然后安照包级变量声明出现的顺序依次初始化。</li>
<li>每个包在解决依赖的前提下，以导入声明的顺序初始化，每个包只会被初始化一次。因此，如果一个p包导入了q包，那么在p包初始化的时候可以认为q包必然已经初始化过了。初始化工作是自下而上进行的，main包最后被初始化。以这种方式，可以确保在main函数执行之前，所有依然的包都已经完成初始化工作了。</li>
</ol>
<h2 id="Programming-Pitfall"><a href="#Programming-Pitfall" class="headerlink" title="Programming Pitfall"></a>Programming Pitfall</h2><h3 id="迭代变量"><a href="#迭代变量" class="headerlink" title="迭代变量"></a>迭代变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">错误方式：可能会一直输出最后一个元素</span><br><span class="line">for val := range values &#123;</span><br><span class="line">    go func() &#123;</span><br><span class="line">        fmt.Println(val)</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">正确方式：</span><br><span class="line">for val := range values &#123;</span><br><span class="line">    go func(val interface&#123;&#125;) &#123;</span><br><span class="line">        fmt.Println(val)</span><br><span class="line">    &#125;(val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="内存同步"><a href="#内存同步" class="headerlink" title="内存同步"></a>内存同步</h3><p>下面的代码段可能输出如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x:0 y:0</span><br><span class="line">y:0 x:0</span><br></pre></td></tr></table></figure>
<p>解释：在一个独立的goroutine中，每一个语句的执行顺序是可以被保证的；也就是说goroutine是顺序连贯的。但是在不使用channel且不使用mutex这样的显式同步操作时，我们就没法保证事件在不同的goroutine中看到的执行顺序是一致的了。尽管goroutine A中一定需要观察到x=1执行成功之后才会去读取y，但它没法确保自己观察得到goroutine B中对y的写入，所以A还可能会打印出y的一个旧版的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var x, y int</span><br><span class="line"></span><br><span class="line">go func() &#123;</span><br><span class="line">    x = 1 // A1</span><br><span class="line">    fmt.Print(&quot;y:&quot;, y, &quot; &quot;) // A2</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">go func() &#123;</span><br><span class="line">    y = 1                   // B1</span><br><span class="line">    fmt.Print(&quot;x:&quot;, x, &quot; &quot;) // B2</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<h2 id="Programming-Pattern"><a href="#Programming-Pattern" class="headerlink" title="Programming Pattern"></a>Programming Pattern</h2><h3 id="计算函数运行时间"><a href="#计算函数运行时间" class="headerlink" title="计算函数运行时间"></a>计算函数运行时间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func bigSlowOperation() &#123;</span><br><span class="line">    defer trace(&quot;bigSlowOperation&quot;)() // don&apos;t forget the extra parentheses</span><br><span class="line">    // ...lots of work…</span><br><span class="line">    time.Sleep(10 * time.Second) // simulate slow operation by sleeping</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func trace(msg string) func() &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    log.Printf(&quot;enter %s&quot;, msg)</span><br><span class="line">    return func() &#123; </span><br><span class="line">        log.Printf(&quot;exit %s (%s)&quot;, msg,time.Since(start)) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用锁进行并发"><a href="#使用锁进行并发" class="headerlink" title="使用锁进行并发"></a>使用锁进行并发</h3><p>传统的并发做法，使用锁来避免竞争条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var (</span><br><span class="line">    mu      sync.Mutex // guards balance</span><br><span class="line">    balance int</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Deposit(amount int) &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    defer mu.Unlock()</span><br><span class="line">    balance = balance + amount</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Balance() int &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    defer mu.Unlock()</span><br><span class="line">    return balance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用通信进行并发"><a href="#使用通信进行并发" class="headerlink" title="使用通信进行并发"></a>使用通信进行并发</h3><p>Go推荐的做法：不要使用共享数据来通信；使用通信来共享数据。一个提供对指定变量通过cahnnel来请求的goroutine叫做这个变量的监控(monitor)goroutine，只有一个goroutine能够访问变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var deposits = make(chan int) // send amount to deposit</span><br><span class="line">var balances = make(chan int) // receive balance</span><br><span class="line"></span><br><span class="line">func Deposit(amount int) &#123; deposits &lt;- amount &#125;</span><br><span class="line">func Balance() int       &#123; return &lt;-balances &#125;</span><br><span class="line"></span><br><span class="line">func teller() &#123;</span><br><span class="line">    var balance int // balance is confined to teller goroutine</span><br><span class="line">    for &#123;</span><br><span class="line">        select &#123;</span><br><span class="line">        case amount := &lt;-deposits:</span><br><span class="line">            balance += amount</span><br><span class="line">        case balances &lt;- balance:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line">    go teller() // start the monitor goroutine</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="广播机制"><a href="#广播机制" class="headerlink" title="广播机制"></a>广播机制</h3><p>关闭同步channel可以让所有等待该channel的goroutine都收到信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">type entry struct &#123;</span><br><span class="line">    res   result</span><br><span class="line">    ready chan struct&#123;&#125; // closed when res is ready</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func New(f Func) *Memo &#123;</span><br><span class="line">    return &amp;Memo&#123;f: f, cache: make(map[string]*entry)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Memo struct &#123;</span><br><span class="line">    f     Func</span><br><span class="line">    mu    sync.Mutex // guards cache</span><br><span class="line">    cache map[string]*entry</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (memo *Memo) Get(key string) (value interface&#123;&#125;, err error) &#123;</span><br><span class="line">    memo.mu.Lock()</span><br><span class="line">    e := memo.cache[key]</span><br><span class="line">    if e == nil &#123;</span><br><span class="line">        // This is the first request for this key.</span><br><span class="line">        // This goroutine becomes responsible for computing</span><br><span class="line">        // the value and broadcasting the ready condition.</span><br><span class="line">        e = &amp;entry&#123;ready: make(chan struct&#123;&#125;)&#125;</span><br><span class="line">        memo.cache[key] = e</span><br><span class="line">        memo.mu.Unlock()</span><br><span class="line"></span><br><span class="line">        e.res.value, e.res.err = memo.f(key)</span><br><span class="line"></span><br><span class="line">        close(e.ready) // broadcast ready condition</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // This is a repeat request for this key.</span><br><span class="line">        memo.mu.Unlock()</span><br><span class="line"></span><br><span class="line">        &lt;-e.ready // wait for ready condition</span><br><span class="line">    &#125;</span><br><span class="line">    return e.res.value, e.res.err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/16/红黑树/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/16/红黑树/" itemprop="url">
                  红黑树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-16T10:24:31+08:00">
                2016-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/16/红黑树/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/16/红黑树/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在复习数据结构，打算用Go语言实现一下常用的数据结构，所以就有了这篇文章，维基百科上关于红黑树的基本描述如下：</p>
<blockquote>
<p>红黑树（英语：Red–black tree）是一种自平衡二叉查找树，可以在O(log n)时间内做查找，插入和删除。</p>
</blockquote>
<h2 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h2><p>红黑树是每个节点都带有颜色属性的二叉查找树，颜色为红色或黑色。在二叉查找树强制一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求：   </p>
<ol>
<li>节点是红色或黑色。</li>
<li>根是黑色。</li>
<li>所有叶子都是黑色（叶子是NIL节点，这个特性在插入里面用不到，在节点删除里面起作用）。</li>
<li>每个红色节点必须有两个黑色的子节点。（从每个叶子到根的所有路径上不能有两个连续的红色节点。）</li>
<li>从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。</li>
</ol>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/rbtree.png" width="500" height="300" alt="红黑树示例图" style="clear: both; display: block; margin:auto; "></p>
<p>这些约束确保了红黑树的关键特性：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的，而不同于普通的二叉查找树。</p>
<p>要知道为什么这些性质确保了这个结果，注意到性质4导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质5所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。</p>
<h2 id="实现准备"><a href="#实现准备" class="headerlink" title="实现准备"></a>实现准备</h2><p><strong>基本定义</strong>，包括节点和树的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const (</span><br><span class="line">    RED   bool = true</span><br><span class="line">    BLACK bool = false</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type RBNode struct &#123;</span><br><span class="line">    value               int64</span><br><span class="line">    color               bool</span><br><span class="line">    left, right, parent *RBNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type RBTree struct &#123;</span><br><span class="line">    root *RBNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>基本操作</strong>，包括左旋和右旋：</p>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/left_rotate.jpg" width="400" height="150" alt="左旋示例图" style="clear: both; display: block; margin:auto; "></p>
<p><strong>左旋</strong>：以P为轴心左旋，左旋必须要有右子节点，右子节点N成为P的父亲，N的左子节点成为P的右子节点</p>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/right_rotate.jpg" width="400" height="160" alt="右旋示例图" style="clear: both; display: block; margin:auto; "></p>
<p><strong>右旋</strong>：以P为轴心右旋，右旋必须要有左子节点，左子节点N成为P的父亲，N的右子节点成为P的左子节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 只贴左旋的代码，右旋完全类似</span><br><span class="line">// 注意：如果树的root可能发生变化，需要返回旋转后的父亲节点</span><br><span class="line">func (self *RBNode) leftRotate() (*RBNode, error) &#123;</span><br><span class="line">    var root *RBNode</span><br><span class="line">    if self == nil &#123;</span><br><span class="line">        return root, nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    parent := self.parent</span><br><span class="line">    rightChild := self.right</span><br><span class="line">    if rightChild == nil &#123;</span><br><span class="line">        return root, errors.New(&quot;left rotate node without right child&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // rotate</span><br><span class="line">    rightChildLeft := rightChild.left</span><br><span class="line">    rightChild.left = self</span><br><span class="line">    self.parent = rightChild</span><br><span class="line">    self.right = rightChildLeft</span><br><span class="line">    if rightChildLeft != nil &#123;</span><br><span class="line">        rightChildLeft.parent = self</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if parent == nil &#123;</span><br><span class="line">        root = rightChild</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 判断左右</span><br><span class="line">        if parent.left == self &#123;</span><br><span class="line">            parent.left = rightChild</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            parent.right = rightChild</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    rightChild.parent = parent</span><br><span class="line"></span><br><span class="line">    return root, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>二叉搜索树插入的节点一定是叶子节点，因此考虑性质5，则插入节点只能是红色的。首先实现二叉搜索树的插入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 插入，二叉搜索树的插入方法，插入成功之后进行调整</span><br><span class="line">func (self *RBTree) insertNode(node *RBNode, data int64) &#123;</span><br><span class="line">    if node.value &gt;= data &#123;</span><br><span class="line">        if node.left == nil &#123;</span><br><span class="line">            tmp := NewRBNode(data)</span><br><span class="line">            tmp.parent = node</span><br><span class="line">            node.left = tmp</span><br><span class="line">            self.adjust(tmp)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.insertNode(node.left, data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if node.right == nil &#123;</span><br><span class="line">            tmp := NewRBNode(data)</span><br><span class="line">            tmp.parent = node</span><br><span class="line">            node.right = tmp</span><br><span class="line">            self.adjust(tmp)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.insertNode(node.right, data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>红黑树的调整分5种情况，实际上是7种情况，不过有两种情况是对称的，有的情况需要递归到其他情况：</p>
<p><strong>情形1</strong>: 新节点N位于树的根上，没有父节点</p>
<ul>
<li>在这种情形下（其他情况递归也可能到这种情况），我们把它重绘为黑色以满足性质2。因为它在每个路径上对黑节点数目增加一，性质5符合。</li>
</ul>
<p><strong>情形2</strong>: 新节点的父节点P是黑色</p>
<ul>
<li>性质4没有失效（新节点是红色的）。</li>
<li>在这种情形下，树仍是有效的。性质5也未受到威胁，尽管新节点N有两个黑色叶子子节点；但由于新节点N是红色，通过它的每个子节点的路径就都有同通过它所取代的黑色的叶子的路径同样数目的黑色节点，所以依然满足这个性质。</li>
</ul>
<p><strong>情形3</strong>: 如果父节点P和叔父节点U二者都是红色</p>
<ul>
<li>此时新插入节点N做为P的左子节点或右子节点都属于情形3，这里右图仅显示N做为P左子的情形，则我们可以将它们两个重绘为黑色并重绘祖父节点G为红色（用来保持性质5）。</li>
<li>现在我们的新节点N有了一个黑色的父节点P。因为通过父节点P或叔父节点U的任何路径都必定通过祖父节点G，在这些路径上的黑节点数目没有改变。</li>
<li>但是，红色的祖父节点G可能是根节点，这就违反了性质2，也有可能祖父节点G的父节点是红色的，这就违反了性质4。为了解决这个问题，我们在祖父节点G上递归地进行情形1的整个过程。（把G当成是新加入的节点进行各种情形的检查）</li>
</ul>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/rb_tree_insert_case_3.png" width="400" height="150" alt="情形3" style="clear: both; display: block; margin:auto; "></p>
<p><strong>情形4</strong>: 父节点P是红色而叔父节点U是黑色或缺少，并且新节点N是其父节点P的右子节点而父节点P又是其父节点的左子节点，简称为“左右”</p>
<ul>
<li>在这种情形下，我们进行一次左旋转调换新节点和其父节点的角色;</li>
<li>接着，我们按情形5处理以前的父节点P以解决仍然失效的性质4。注意这个改变会导致某些路径通过它们以前不通过的新节点N（比如图中1号叶子节点）或不通过节点P（比如图中3号叶子节点），但由于这两个节点都是红色的，所以性质5仍有效。</li>
</ul>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/rb_tree_insert_case_4.png" width="400" height="150" alt="情形4" style="clear: both; display: block; margin:auto; "></p>
<p><strong>情形5</strong>: 父节点P是红色而叔父节点U是黑色或缺少，新节点N是其父节点的左子节点，而父节点P又是其父节点G的左子节点。简称为“左左”</p>
<ul>
<li>在这种情形下，我们进行针对祖父节点G的一次右旋转；在旋转产生的树中，以前的父节点P现在是新节点N和以前的祖父节点G的父节点。我们知道以前的祖父节点G是黑色，否则父节点P就不可能是红色（如果P和G都是红色就违反了性质4，所以G必须是黑色）。我们切换以前的父节点P和祖父节点G的颜色，结果的树满足性质4。性质5也仍然保持满足，因为通过这三个节点中任何一个的所有路径以前都通过祖父节点G，现在它们都通过以前的父节点P。在各自的情形下，这都是三个节点中唯一的黑色节点。</li>
</ul>
<p><img src="http://o7b0ga5fo.bkt.clouddn.com/images/rbtree/rb_tree_insert_case_5.png" width="400" height="150" alt="情形5" style="clear: both; display: block; margin:auto; "></p>
<p><strong>调整代码如下</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">func (self *RBTree) adjust(node *RBNode) &#123;</span><br><span class="line">    parent := node.parent</span><br><span class="line">    if parent == nil &#123;</span><br><span class="line">        // 情形1：（递归后）新节点位于树的根上</span><br><span class="line">        node.color = BLACK</span><br><span class="line">        self.root = node</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if parent.color == BLACK &#123;</span><br><span class="line">        // 情形2：新节点的父节点P是黑色，性质不失效</span><br><span class="line">        return</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        uncle := node.getUncle()</span><br><span class="line">        grandParent := node.getGrandParent()</span><br><span class="line">        if uncle != nil &amp;&amp; uncle.color == RED &#123;</span><br><span class="line">            // 情形3：父节点和叔父节点均为红色</span><br><span class="line">            // 处理：父节点和叔父节点转为黑色，祖父节点改成红色，递归处理祖父节点</span><br><span class="line">            node.parent.color = BLACK</span><br><span class="line">            uncle.color = BLACK</span><br><span class="line">            grandParent.color = RED</span><br><span class="line">            self.adjust(grandParent)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            isLeft := (node == parent.left)</span><br><span class="line">            isParentLeft := (node.parent == grandParent.left)</span><br><span class="line">            if isLeft &amp;&amp; isParentLeft &#123;</span><br><span class="line">                // 情形5：左左</span><br><span class="line">                // 处理：祖父节点右旋</span><br><span class="line">                node.parent.color = BLACK</span><br><span class="line">                grandParent.color = RED</span><br><span class="line">                self.rotateRight(grandParent)</span><br><span class="line">            &#125; else if !isLeft &amp;&amp; isParentLeft &#123;</span><br><span class="line">                // 情形4：左右</span><br><span class="line">                // 处理：父节点左旋，变成情形4左左</span><br><span class="line">                self.rotateLeft(node.parent)</span><br><span class="line">                // 现在的node.parent表示原来的祖父节点</span><br><span class="line">                self.rotateRight(node.parent)</span><br><span class="line"></span><br><span class="line">                node.color = BLACK</span><br><span class="line">                node.left.color = RED</span><br><span class="line">                node.right.color = RED</span><br><span class="line">            &#125; else if isLeft &amp;&amp; !isParentLeft &#123;</span><br><span class="line">                // 情形4对称：右左</span><br><span class="line">                self.rotateRight(node.parent)</span><br><span class="line">                self.rotateLeft(node.parent)</span><br><span class="line"></span><br><span class="line">                node.color = BLACK</span><br><span class="line">                node.left.color = RED</span><br><span class="line">                node.right.color = RED</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // 情形5对称：右右</span><br><span class="line">                node.parent.color = BLACK</span><br><span class="line">                grandParent.color = RED</span><br><span class="line">                self.rotateLeft(grandParent)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>暂时没有实现删除，后续有时间会加上</p>
<p>参考文献：</p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91" target="_blank" rel="external">维基百科</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/01/Http-Header详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/01/Http-Header详解/" itemprop="url">
                  Http Header详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-01T11:07:10+08:00">
                2016-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/04/01/Http-Header详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/01/Http-Header详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Http-Request"><a href="#Http-Request" class="headerlink" title="Http Request"></a>Http Request</h1><h2 id="Accept类"><a href="#Accept类" class="headerlink" title="Accept类"></a>Accept类</h2><ul>
<li>Accept：客户端接受什么样的类型<ul>
<li><code>*/*</code>表示任何类型，<code>text/*</code>表示text类型下的所有子类型，<code>text/plain</code>和<code>text/html</code>表示具体类型</li>
</ul>
</li>
<li>Accept-Charset： 客户端申明自己接收的字符集 </li>
<li>Accept-Encoding： 客户端申明自己接收的编码方法<ul>
<li>通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate） </li>
</ul>
</li>
<li>Accept-Language：客户端申明自己接收的语言 <ul>
<li>语言跟字符集的区别：中文zh是语言，中文有多种字符集，比如big5，gb2312，gbk等等</li>
</ul>
</li>
</ul>
<h2 id="Cache相关"><a href="#Cache相关" class="headerlink" title="Cache相关"></a>Cache相关</h2><ul>
<li>Cache-Control：<ul>
<li>no-cache：不要缓存的实体，要求现在从服务器去取</li>
<li>max-age：只接受Age值小于max-age值，并且没有过期的对象</li>
<li>max-stale：可以接受过去的对象，但是过期时间必须小于max-stale值 </li>
<li>min-fresh：接受其新鲜生命期大于其当前Age跟min-fresh值之和的缓存对象</li>
</ul>
</li>
<li>Pramga：<ul>
<li>主要使用<code>Pramga: no-cache</code>，相当于<code>Cache-Control：no-cache</code></li>
</ul>
</li>
</ul>
<h2 id="Conditional类"><a href="#Conditional类" class="headerlink" title="Conditional类"></a>Conditional类</h2><ul>
<li>If-Modified-Since和If-None-Match：<ul>
<li>两者均表示允许在对应的内容未被修改的情况下返回304未修改，用于validate cache with server</li>
<li>区别在于前者配合Last-Modified使用，后者配合ETag使用</li>
</ul>
</li>
<li>If-Unmodified-Since和If-Match<ul>
<li>两者均表示仅当该实体自某个特定时间已来未被修改的情况下，才进行对应的操作。主要用于更新操作，比如像PUT这样的方法，仅当从用户上次更新某个资源以来，该资源未被修改的情况下，才更新该资源</li>
<li>区别在于前者配合Last-Modified使用，后者配合ETag使用</li>
</ul>
</li>
</ul>
<h2 id="其他重要的"><a href="#其他重要的" class="headerlink" title="其他重要的"></a>其他重要的</h2><ul>
<li>Connection：<ul>
<li>close：告诉WEB服务器或者代理服务器，在完成本次请求的响应后，断开连接，不要等待本次连接的后续请求了</li>
<li>keepalive：告诉WEB服务器或者代理服务器，在完成本次请求的响应后，保持连接，等待本次连接的后续请求 </li>
</ul>
</li>
<li>User-Agent：浏览器表明自己的身份</li>
<li>Upgrade：要求服务器升级到另一个协议，WebSocket会使用 </li>
</ul>
<h1 id="Http-Response"><a href="#Http-Response" class="headerlink" title="Http Response"></a>Http Response</h1><h2 id="Content类"><a href="#Content类" class="headerlink" title="Content类"></a>Content类</h2><ul>
<li>Content-Encoding：服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。</li>
<li>Content-Language：服务器告诉浏览器自己响应的对象的语言。</li>
<li>Content-Length： 服务器告诉浏览器自己响应的对象的长度。</li>
<li>Content-Range： 服务器表明该响应包含的部分对象为整个对象的哪个部分。</li>
<li>Content-Type： 服务器告诉浏览器自己响应的对象的类型。例如：Content-Type：application/xml</li>
<li>Last-Modified：服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。</li>
<li>ETag：对象的标志值，就一个对象而言，比如一个html文件，如果被修改了，其 Etag也会别修改，所以ETag的作用跟Last-Modified的作用差不多，主要供服务器判断一个对象是否改变了。</li>
<li>Transfer-Encoding：服务器表明自己对本响应消息体（不是消息体里面的对象）作了怎样的编码，比如是否分块（chunked），chunk编码将数据分成一块一块的发生。Chunked编码将使用若干个Chunk串连而成，由一个标明长度为0的chunk标示结束。</li>
</ul>
<h2 id="Cache相关-1"><a href="#Cache相关-1" class="headerlink" title="Cache相关"></a>Cache相关</h2><ul>
<li>Cache-Control：<ul>
<li>public：可以用Cached内容回应任何用户</li>
<li>private：只能用缓存内容回应先前请求该内容的那个用户</li>
<li>no-cache：可以缓存，但是只有在跟服务器验证了其有效后，才能返回给客户端 </li>
<li>no-store：不允许缓存</li>
<li>max-age：本响应包含的对象的过期时间</li>
</ul>
</li>
<li>Vary：服务器用该头部的内容告诉Cache服务器（代理服务器或者网关），在什么条件下才能用本响应所返回的对象响应后续的请求。<ul>
<li>解释：源服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding: gzip; Vary: Content-Encoding那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。</li>
</ul>
</li>
</ul>
<h2 id="其他重要的-1"><a href="#其他重要的-1" class="headerlink" title="其他重要的"></a>其他重要的</h2><ul>
<li>Connection：针对该连接所预期的选项，服务器应该可以修改</li>
<li>Via： 列出从客户端到OCS或者相反方向的响应经过了哪些代理服务器，他们用什么协议（和版本）发送的请求。<ul>
<li>解释：当客户端请求到达第一个代理服务器时，该服务器会在自己发出的请求里面添加Via头部，并填上自己的相关信息，当下一个代理服务器收到第一个代理服务器的请求时，会在自己发出的请求里面复制前一个代理服务器的请求的Via头部，并把自己的相关信息加到后面，以此类推，当OCS收到最后一个代理服务器的请求时，检查Via头部，就知道该请求所经过的路由。</li>
</ul>
</li>
<li>Server: 服务器表明自己是什么软件及版本等信息</li>
</ul>
<p>参考文献：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields" target="_blank" rel="external">List_of_HTTP_header_fields</a></li>
<li><a href="http://www.cnblogs.com/skynet/archive/2010/12/11/1903347.html" target="_blank" rel="external">HTTP Keep-Alive模式</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/31/Play-Framework的异步机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/31/Play-Framework的异步机制/" itemprop="url">
                  Play Framework的异步机制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-31T16:31:15+08:00">
                2016-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/31/Play-Framework的异步机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/31/Play-Framework的异步机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近看Play的文档，其中有如下描述：</p>
<blockquote>
<p>Internally, <a href="https://www.playframework.com/documentation/2.4.x/ScalaAsync" target="_blank" rel="external">Play Framework</a> is asynchronous from the bottom up. Play handles every request in an asynchronous, non-blocking way.<br>The default configuration is tuned for asynchronous controllers. In other words, the application code should avoid blocking in controllers, i.e., having the controller code wait for an operation. Common examples of such blocking operations are JDBC calls, streaming API, HTTP requests and long computations.</p>
</blockquote>
<p>然后介绍了如何构建异步的Actions，最后又说:</p>
<blockquote>
<p>Play actions are asynchronous by default.</p>
</blockquote>
<p>我有点纳闷：既然本身就是异步的，为什么还让我们自己构建异步的Actions，最后居然说本来就是异步的，岂不是说了半天废话？</p>
<p>后来经过多次google发现，框架是异步的仅仅表示用来处理requests的线程不会block，实际上<code>Action.apply</code>和<code>Action.async</code>除了签名，本质上没有区别，后者返回的是一个<code>Future</code>，前者会将<code>block: =&gt; Result</code>通过<code>Future.successful(block)</code>转换成<code>Future[Result]</code>，这样处理requests的线程就不会block了。</p>
<p>但是，没有什么魔法能够简单的将block操作变成non-block操作。<code>Future</code>也需要地方执行，不可能凭空就跑出结果来。实际上，<code>Future</code>的执行需要环境，也就是线程池，你可以使用scala自带的<code>ExecutionContext</code>，也可以自己实现。下面的代码清楚的说明了这一点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; import scala.concurrent.Future</span><br><span class="line">import scala.concurrent.Future</span><br><span class="line"></span><br><span class="line">scala&gt; import scala.concurrent.ExecutionContext.Implicits.global</span><br><span class="line">import scala.concurrent.ExecutionContext.Implicits.global</span><br><span class="line"></span><br><span class="line">scala&gt; Thread.currentThread.getId()</span><br><span class="line">res0: Long = 1</span><br><span class="line"></span><br><span class="line">scala&gt; (1 to 5).map(x =&gt; Future &#123; Thread.currentThread.getId() &#125;).map(_.value.get) foreach println</span><br><span class="line">Success(12)</span><br><span class="line">Success(14)</span><br><span class="line">Success(13)</span><br><span class="line">Success(13)</span><br><span class="line">Success(13)</span><br></pre></td></tr></table></figure></p>
<p><font color="red"><code>Future</code>会被扔到线程池里面去继续执行，如果执行的过程中有block的操作，该线程还是会被block住，只是它不会block遇到<code>Future</code>的线程而已。</font>这也是Play声称自己是异步框架的原因，requests会被很快的处理，压力被放到了其他的线程池上。下面的话也说明了这一点，进件包上一层<code>Future</code>并不能解决所有的问题，你还是需要自己去处理应用中出现的block问题。Play有自己默认的线程池，你也可以根据应用需求，为不同的<code>Future</code>分配不同的<code>ExecutionContext</code>。如果采用第三方库，需要库本身提供的API就是异步的（第三方库自带线程池实现）。</p>
<blockquote>
<p>Because of this, if you plan to write blocking IO code, or code that could potentially do a lot of CPU intensive work, you need to know exactly which thread pool is bearing that workload, and you need to tune it accordingly.</p>
</blockquote>
<p>至此，基本上明白了Play声称的异步框架的含义。</p>
<p>参考文献：</p>
<ul>
<li><a href="https://www.playframework.com/documentation/2.4.x/ScalaAsync" target="_blank" rel="external">https://www.playframework.com/documentation/2.4.x/ScalaAsync</a></li>
<li><a href="https://www.playframework.com/documentation/2.4.x/ThreadPools" target="_blank" rel="external">https://www.playframework.com/documentation/2.4.x/ThreadPools</a></li>
<li><a href="http://stackoverflow.com/a/23648137/4066546" target="_blank" rel="external">http://stackoverflow.com/a/23648137/4066546</a></li>
<li><a href="http://stackoverflow.com/a/24004444/4066546" target="_blank" rel="external">http://stackoverflow.com/a/24004444/4066546</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/29/Hello-World/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zjiash">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zjiash的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/29/Hello-World/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-29T16:13:50+08:00">
                2016-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随笔/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/03/29/Hello-World/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/29/Hello-World/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是一个测试文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;hello world!&quot;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="zjiash" />
          <p class="site-author-name" itemprop="name">zjiash</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zjiash" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zjiash</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zjiash"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
